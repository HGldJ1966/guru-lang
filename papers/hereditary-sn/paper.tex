\documentclass{article}

%\usepackage{latex8}
%\usepackage{times}
\usepackage{amsmath}
\usepackage{latexsym}
\usepackage{amssymb}
\usepackage{proof}
\usepackage{url}

% \usepackage{natbib}
%  \bibpunct();A{},
%  \let\cite=\citep

\newcommand{\lam}[2]{\lambda #1 . #2}
\newcommand{\lams}[2]{\lambda^* #1 . #2}
\newcommand{\alet}[3]{\textit{let}\ #1\ :=\ #2\ \textit{in}\ #3}
\newcommand{\Thet}[1]{\lam{V}{\lam{L}{\lam{A}{\lam{O}{\lam{C}{\lam{S}{\lam{D}{#1}}}}}}}}
\newcommand{\ope}[0]{\textit{open}}
\newcommand{\swap}[0]{\textit{swap}}
\newcommand{\vcomp}[0]{\textit{vcomp}}
\newcommand{\nlambda}[0]{\bar{\lambda}}
\newcommand{\nlam}[2]{\nlambda #1 . #2}
\newcommand{\rulename}[1]{\text{\textup{\textsf{#1}}}}
\newcommand\bs{\char '134 }  % A backslash character for \tt font
\newcommand{\seq}[3]{#1 \vdash #2 : #3}
\newcommand{\eval}[0]{\Downarrow}
\newcommand{\evalj}[2]{#1\, \eval\, #2}
\newcommand{\starstar}[0]{*\negthinspace*}
\newcommand{\nat}[0]{\mathbb{N}}
\newcommand{\red}[0]{\textit{Red}}
\newcommand{\redsub}[1]{\textit{Red}(\rhd(#1))}
\newcommand{\sn}[0]{\textit{SN}}
\newcommand{\optt}{\textsc{OpTT}}

\newcommand{\rase}[1]{\ulcorner #1 \urcorner}
\newcommand{\lowr}[1]{\llcorner #1 \lrcorner}

\newcommand{\Eq}[0]{\texttt{=}}
\newcommand{\Neq}[0]{\texttt{!=}}
\newcommand{\Qeq}[0]{\stackrel{?}{=}}
\newcommand{\bang}[0]{\texttt{!}}
\newcommand{\quant}[0]{\textit{Quant}}

\newtheorem{theorem}{Theorem}
\newtheorem{definition}{Definition}
\newtheorem{lemma}{Lemma}

\newcommand{\To}{\Rightarrow}
\newcommand{\gtrans}[2]{#1 \cdot #2}
\newcommand{\gtransa}[2]{#1 \cdot_1 #2}
\newcommand{\gtransb}[2]{#1 \cdot_2 #2}
\newcommand{\gsymm}[1]{#1^{-1}}
\newcommand{\gcong}[1]{f(#1)}
\newcommand{\ginj}[1]{f^{-1}(#1)}
\newcommand{\guru}[0]{\textsc{Guru}}

\begin{document}

\title{Hereditary Normalization for Terms and Types}

\author{Aaron Stump \\
CS, The University of Iowa \\
\url{astump@acm.org}}
%astump@acm.org,mdeters@cse.wustl.edu,tws2@cec.wustl.edu,tas5@cec.wustl.edu,ewestbro@cse.wustl.edu

%\date{}

\maketitle

%\thispagestyle{empty}

\begin{abstract}
\end{abstract}

\section{Introduction}

Proofs and Types~\cite{pat}.

\section{Syntax}

Standard syntax for types and terms is given in
Figure~\ref{fig:syntax}.

\begin{figure}
\begin{eqnarray*}
T & \ ::=\ & \top\ |\ T_1 \to T_2\ |\ T_1 \vee T_2 \\ \\
t & \ ::=\ & x^T\ |\ \top_I\ |\ \lambda x^T.\ t\ |\ (t_1\ t_2)\ |\ \langle i, t \rangle\ |\ \texttt{case}\ t\ \texttt{of}\ \lambda x^{T_1}.\ t_1,\ \lambda x^{T_2}. \ t_2
\end{eqnarray*}
\caption{\label{fig:syntax}Types ($T$) and Terms ($t$)}
\end{figure}

\section{Typing}

Typing rules for terms are given in Figure~\ref{fig:typing}.

\begin{figure}
\begin{tabular}{ll}

\infer{x^T\ :\ T}{\ } 

&

\infer{\top_I\ :\ \top}{\ }

\\ \\

\infer{\lambda x^{T_1}.\ t\ :\ T_1 \to T_2}
      {t\ :\ T_2}

&

\infer{(t_1\ t_2)\ :\ T_2}
      {t_1\ :\ T_1 \to T_2 \ \ &\ \  t_2\ :\ T_1}

\\ \\

\infer{\langle i, t \rangle\ :\ T_1 \vee T_2}
      {t\ :\ T_i \ \ &\ \  i \in \{1,2\}}


&

\infer{\texttt{case}\ t\ \texttt{of}\ \lambda x^{T_1}. t_1, \lambda x^{T_2}. t_2\ :\ T}
      {t\ :\ T_1\vee T_2\ \  &\ \  t_1\ :\ T\ \  &\ \  t_2\ :\ T}

\end{tabular}
\caption{\label{fig:typing}Typing Rules for Terms}
\end{figure}

\section{Reduction}

Reduction rules for terms are given in Figure~\ref{fig:red}.  The
first two rules are detour-reduction rules for $\to$ and $\vee$, while
the second two are commuting conversions for $\vee$-elimination.
Reduction is the compatible closure of these rules.

\begin{figure}
\begin{eqnarray*}
(\lambda x^T.\ t_1)\ t_2 & \ \leadsto\  & [t_2/x]t_1 \\ \\
\texttt{case}\ \langle i, t \rangle\ \texttt{of}\ \lambda x^{T_1}. t_1, \lambda x^{T_2}. t_2 & \leadsto & 
  [t/x]t_i \\ \\
(\texttt{case}\ t\ \texttt{of}\ \lambda x^{T_1}.t_1,\lambda x^{T_2}.t_2)\ t' & \leadsto & 
  \texttt{case}\ t\ \texttt{of}\ \lambda x^{T_1}.(t_1\ t'), \lambda x^{T_2}.(t_2\ t') \\ \\
\texttt{case}\ (\texttt{case}\ t\ \texttt{of}\ \lambda x^{T_1}.t_1,\lambda x^{T_2}.t_2) \ \texttt{of}\ 
C_1,C_2 & \leadsto & 
\texttt{case}\ t\ \texttt{of}\ (\lambda x^{T_1}.\texttt{case}\ t_1\ \texttt{of}\ C_1, C_2),\\
\ &\ &
\ \ \ \ \ \ \ \ \ \ \ \ \ \ (\lambda x^{T_2}.\texttt{case}\ t_2\ \texttt{of}\ C_1, C_2)
\end{eqnarray*}
\caption{\label{fig:red}Reduction Rules}
\end{figure}

\section{Type-Hereditary Normalization}

The definition of a type-based form of hereditary normalization, based
on standard ideas of reducibility, is given in
Figure~\ref{fig:type-hn}.  The definition is by recursion on the
structure of the type subscript to \red.  It relies on a predicate
\sn\ whose extension is the set of strongly normalizing terms.  Note
that a hereditary condition is imposed only for $\to$-types.  A
hereditary condition is usually imposed for all compound types, though
$\vee$-types are problematic.

\begin{figure}
\begin{eqnarray*}
\red_{\top}(t) & \Leftrightarrow & \sn(t) \\
\red_{T_1\vee T_2}(t) & \Leftrightarrow & \sn(t) \\
\red_{T_1\to T_2}(t) & \Leftrightarrow & \forall t', \red_{T_1}(t')\ \To\ \red_{T_2}(t\ t')
\end{eqnarray*}
\caption{\label{fig:type-hn} Type-Hereditary Normalization}
\end{figure}

\section{Term-Hereditary Normalization}

Write $t' \rhd t$ iff $t$ is a subterm of $t'$.  Generally, we will
write $R(x)$ for the image of binary relation $R$ on $x$; that is, $\{
y | R(x,y) \}$.  Also, if $P$ is a predicate, we will write $P(S)$,
for $S$ a set, to indicate that $P$ holds of every element of $S$.  To
define our term-based form of hereditary normalization, we first adopt
the following definition of a predicate $\red$ with no subscript:

\begin{eqnarray*}
\red(t) &\ \Leftrightarrow\ & t : T\ \textnormal{and}\ \red_{T}(t)
\end{eqnarray*}

\noindent A term is defined to be term-hereditarily normalizing iff
all its subterms are type-hereditarily normalizing at their types.
Thanks to the two general notations just introduced, this predicate
may be written as just $\red(\rhd(t))$.  In what follows, we will
sometimes say that predicate $P_1$ implies predicate $P_2$, to mean
that the extension of the first is a subset of the extension of the
second (or equivalently, $\forall x, P_1(x)\ \To\ P_2(x)$.

\section{Critical Properties of $\red \circ \rhd$}

First, let us note the following simple property of \sn: $\sn(t)$ iff
$\sn(\leadsto(t))$.  Then similarly to the proof in~\cite{pat}, we show
the following critical properties of $\red \circ \rhd$:

\begin{itemize}
\item \textbf{CR1.} $\redsub{t} \ \To \sn(t)$.
\item \textbf{CR2.} $\redsub{t}\ \Leftrightarrow\ \redsub{\leadsto(t)}$.
\end{itemize}

\noindent Note that the second property says both that reduction
preserves type-hereditary normalization, and that type-hereditary
normalization is progressive with respect to reduction.

The proof is by induction on the type $T$.  We consider first
\textbf{CR1}.  When $T$ is a $\vee$-type or $\top$, \textbf{CR1}
follows immediately by definition of $\red_T$.  So suppose $T \equiv
T_1\to T_2$, and consider arbitrary $t\ :\ T_1\to T_2$ with
$\red_{T}(t)$.  By assumption, we have $\red_{T_2}(t\ t')$ for all
$t'$ with $\red_{T_1}(t')$.  In particular, this is true for a
variable $x^{T_1}$, as long as $\red_{T_1}(x^{T_1})$ holds.  We do
have $\red_{T_1}(x^{T_1})$, since $\redsub{\leadsto(x^{T_1})}$ holds
vacuously (since $x^{T_1}$ has no $\leadsto$-successors and no proper
subterms), and so we may apply \textbf{CR2} at smaller type $T_1$.  By
\textbf{CR1} at smaller type $T_2$, we have $\sn(t\ x^{T_1})$, which
implies $\sn(t)$.

Now consider \textbf{CR2}.  We proceed by inner induction on $t$.  We
may reason about the proper subterms of $t$ without considering the
form of $T$, so we do that first.  Assume $\redsub{t}$, and consider
an arbitrary proper subterm $t'$ of an element of $\leadsto(t)$.  We
must show $\red(t')$.  Either $t'$ is itself a subterm of $t$, in
which case we have $\red(t')$ from our assumption of $\redsub{t}$, or
else there is a subterm $t''$ of $t$ such that $t' \in \leadsto(t'')$.
Certainly we have $\redsub{t''}$ from $\redsub{t}$, and so our inner
induction hypothesis gives us $\red(t')$, as required.  For the
converse, assume $\redsub{\leadsto(t)}$, and consider an arbitrary
subterm $t'$ of $t$.  We must show $\red(t')$.  Consider
$\leadsto(t')$.  We certainly have $\leadsto(t') \subset
\leadsto(\rhd(t))$.  We may observe that $\leadsto \circ \rhd = \rhd
\circ \leadsto$, and so $\leadsto(t') \subset \rhd(\leadsto(t))$.  From
our assumption, the latter set is included the extension of $\red$, so
$\leadsto(t')$ is also.  By inner induction hypothesis, this gives us
$\redsub{t'}$.

Having dispatched the proper subterms, it now suffices to prove
$\red_{T}(t)$ iff $\red_{T}(\leadsto(t))$.  When $T$ is $\top$ or
$\vee$, we have $\red_T(t)$ iff $\red_T(\leadsto(t))$ for all $t:T$,
from the similar property of $\sn$, noted above.  So consider the case
when $T\equiv T_1\to T_2$, and consider arbitrary $t:T$.  First
suppose $\red_{T}(t)$, and show $\red_T(\leadsto(t))$.  So consider
arbitrary $t'$ with $t\leadsto t'$, and show $\red_T(t')$.  For this,
we consider an arbitrary $t''$ with $\red_{T_1}(t'')$, and we must
show $\red_{T_2}(t'\ t'')$.  We certainly have $(t\ t'')\leadsto (t'\
t'')$, since $t\leadsto t'$.  From the assumption that $\red_{T}(t)$,
we have $\red_{T_2}(t\ t'')$.  Then by $\To$-direction of \textbf{CR2}
at smaller type $T_2$, we get the desired $\red_{T_2}(t'\ t'')$.  Now
assume $\red_T(\leadsto(t))$, and show $\red_T(t)$.  For this,
consider arbitrary $t''$ with $\red_{T_1}(t'')$, and show
$\red_{T_2}(t\ t'')$.  To show this, it suffices to show
$\red_{T_2}(\leadsto(t\ t''))$, by \textbf{CR2} at smaller type $T_2$.
So consider arbitrary $t'$ with $(t\ t'')\leadsto t'$.  We proceed by
case analysis of the form of the reduction.  If $t' \equiv (t_a\ t'')$
with the reduction due to $t\leadsto t_a$, then by assumption $\red_{T_1\to T_2}(t_a)$,
and so $\red_{T_2}(t_a\ t'')$.   or $t'' \leadsto
t_b$, then 




\bibliographystyle{plain}

%\nocite{SH80}
\bibliography{partiality,misc_logic,automated_reasoning,formal_methods,verification,lf,general,refinement,coop_dec_procs,cl,rewriting,theorem_provers,sat,program_analysis,software_engineering,specification,pl,stanford_group,hoas,semantic_programming,misc}



\end{document}
